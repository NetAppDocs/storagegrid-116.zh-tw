---
permalink: ilm/example-4-ilm-rules-and-policy-for-s3-versioned-objects.html 
sidebar: sidebar 
keywords: object versions, example ILM rule, information lifecycle rule examples 
summary: 如果已啟用版本管理功能的S3儲存區、您可以在ILM原則中加入使用非目前時間做為參考時間的規則、藉此管理非目前物件版本。 
---
= 範例4：S3版本化物件的ILM規則和原則
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
如果已啟用版本管理功能的S3儲存區、您可以在ILM原則中加入使用*非目前時間*做為參考時間的規則、藉此管理非目前物件版本。

如本範例所示、您可以針對非目前物件版本、使用不同的放置說明來控制版本控制物件所使用的儲存容量。


CAUTION: 下列ILM規則和原則僅為範例。有許多方法可以設定ILM規則。在啟動新原則之前、請先模擬建議的原則、確認其運作方式符合保護內容免於遺失的目的。


NOTE: 如果您建立ILM原則來管理非目前的物件版本、請注意、您必須知道物件版本的UUID或CBID才能模擬原則。若要尋找物件的UUID和CBID、請在物件仍為最新狀態時使用物件中繼資料查詢。請參閱 xref:verifying-ilm-policy-with-object-metadata-lookup.adoc[使用物件中繼資料查詢來驗證ILM原則]。

.相關資訊
* xref:how-objects-are-deleted.adoc[如何刪除物件]




== ILM規則1例如4：儲存三份複本10年

本範例ILM規則會在三個資料中心儲存每個物件的複本、為期10年。

此規則適用於所有物件、無論其版本是否為版本控制。

[cols="1a,2a"]
|===
| 規則定義 | 範例值 


 a| 
儲存資源池
 a| 
三個儲存集區、每個位於不同的資料中心、分別命名為DC1、DC2和DC3。



 a| 
規則名稱
 a| 
三份十年



 a| 
參考時間
 a| 
擷取時間



 a| 
內容放置
 a| 
在第0天、保留三份複製複本10年（3、652天）、一份在DC1、一份在DC2、一份在DC3。在10年結束時、請刪除物件的所有複本。

|===
image::../media/ilm_rule_1_example_4.png[ILM規則1（例如4）：儲存三份複本5年]



== ILM規則2例如4：將兩個非目前版本的複本儲存2年

本範例ILM規則儲存S3版本物件的兩個非目前版本複本、為期2年。

由於ILM規則1適用於物件的所有版本、因此您必須建立另一個規則、以篩選出任何非目前版本。此規則使用*非目前時間*選項作為參考時間。

在此範例中、只會儲存兩個非目前版本的複本、而這些複本會儲存兩年。

[cols="1a,2a"]
|===
| 規則定義 | 範例值 


 a| 
儲存資源池
 a| 
兩個儲存集區、每個位於不同的資料中心、分別命名為DC1和DC2。



 a| 
規則名稱
 a| 
非最新版本：兩年兩份



 a| 
參考時間
 a| 
非目前時間



 a| 
內容放置
 a| 
在第0天（相對於非目前時間）（亦即、從物件版本成為非目前版本的那一天開始）、將非目前物件版本的兩個複寫複本保留2年（730天）、一個在DC1、一個在DC2。在2年結束時、請刪除非最新版本。

|===
image::../media/ilm_rule_2_example_4.png[ILM規則2例如4：將非目前物件版本保留2年]



== ILM原則、例如4：S3版本控制物件

如果您想要以不同於目前版本的方式來管理物件的舊版本、則使用*非目前時間*做為參考時間的規則必須出現在ILM原則中、才會出現在套用至目前物件版本的規則之前。

S3版本化物件的ILM原則可能包含下列ILM規則：

* 從版本變成非最新的那一天起、將每個物件的任何舊版（非最新版）保留2年。
+

NOTE: 非目前時間規則必須出現在原則中、才會套用至目前物件版本的規則。否則、非目前物件版本將永遠不會與非目前時間規則相符。

* 擷取時、請建立三個複寫複本、並在三個資料中心各儲存一份複本。將目前物件版本的複本保留10年。


image::../media/ilm_policy_example_4.png[ILM原則範例4.]

模擬範例原則時、您預期測試物件的評估方式如下：

* 任何非目前的物件版本都會與第一個規則相符。如果非目前的物件版本早於2年、則ILM會永久刪除該版本（從網格中移除的所有非目前版本複本）。
+

NOTE: 若要模擬非目前物件版本、您必須使用該版本的UUID或CBID。當物件仍為最新狀態時、您可以使用物件中繼資料查詢來尋找其UUID和CBID。

* 目前的物件版本會與第二個規則相符。目前的物件版本儲存10年後、ILM程序會新增刪除標記作為物件的目前版本、並使舊版物件成為「noncurrent」。 下次進行ILM評估時、此非目前版本會與第一個規則相符。因此、DC3的複本會被清除、DC1和DC2的兩個複本會再儲存2年。

